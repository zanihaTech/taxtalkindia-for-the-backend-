"use strict";var express=require("express"),multer=require("multer"),BlogPost=require("../models/BlogPost"),router=express.Router(),storage=multer.diskStorage({destination:function(e,t,r){r(null,"./uploads/")},filename:function(e,t,r){r(null,Date.now()+"-"+t.originalname)}}),upload=multer({storage:storage});router.get("/trending",function(e,t){var r;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(BlogPost.find({},{title:1,likes:1,image:1}).sort({likes:-1}).limit(5));case 3:r=e.sent,t.json(r),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),t.status(500).json({message:"Error fetching trending posts",error:e.t0.message});case 10:case"end":return e.stop()}},null,null,[[0,7]])}),router.get("/",function(e,t){var r;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(BlogPost.find().sort({date:-1}));case 3:r=e.sent,t.json(r),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),t.status(500).json({message:"Error fetching posts",error:e.t0.message});case 10:case"end":return e.stop()}},null,null,[[0,7]])}),router.get("/:id",function(t,r){var n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(BlogPost.findById(t.params.id));case 3:if(n=e.sent){e.next=6;break}return e.abrupt("return",r.status(404).json({message:"Post not found"}));case 6:r.json(n),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),r.status(500).json({message:"Error fetching the post",error:e.t0.message});case 12:case"end":return e.stop()}},null,null,[[0,9]])}),router.post("/create",upload.single("imageFile"),function(t,r){var n,s,a,o,u,c,i;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Uploaded file:",t.file),console.log("Request body:",t.body),n=t.body,s=n.title,a=n.content,o=n.author,u=t.file?"/uploads/"+t.file.filename:null,e.prev=4,c=new BlogPost({title:s,content:a,author:o||"Admin",image:u,likes:0,date:new Date}),e.next=8,regeneratorRuntime.awrap(c.save());case 8:i=e.sent,r.status(201).json(i),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),r.status(500).json({message:"Error creating the post",error:e.t0.message});case 15:case"end":return e.stop()}},null,null,[[4,12]])}),router.put("/:id",upload.single("imageFile"),function(t,r){var n,s,a,o,u,c;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body,s=n.title,a=n.content,o=n.author,u=t.file?"/uploads/"+t.file.filename:null,e.prev=2,e.next=5,regeneratorRuntime.awrap(BlogPost.findByIdAndUpdate(t.params.id,{title:s,content:a,author:o,image:u||t.body.image},{new:!0}));case 5:if(c=e.sent){e.next=8;break}return e.abrupt("return",r.status(404).json({message:"Post not found"}));case 8:r.json(c),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(2),r.status(500).json({message:"Error updating the post",error:e.t0.message});case 14:case"end":return e.stop()}},null,null,[[2,11]])}),router.delete("/:id",function(t,r){var n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(BlogPost.findByIdAndDelete(t.params.id));case 3:if(n=e.sent){e.next=6;break}return e.abrupt("return",r.status(404).json({message:"Post not found"}));case 6:r.json({message:"Post deleted successfully",post:n}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),r.status(500).json({message:"Error deleting the post",error:e.t0.message});case 12:case"end":return e.stop()}},null,null,[[0,9]])}),router.put("/:id/like",function(t,r){var n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(BlogPost.findByIdAndUpdate(t.params.id,{$inc:{likes:1}},{new:!0}));case 3:if(n=e.sent){e.next=6;break}return e.abrupt("return",r.status(404).json({message:"Post not found"}));case 6:r.json(n),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),r.status(500).json({message:"Error liking the post",error:e.t0.message});case 12:case"end":return e.stop()}},null,null,[[0,9]])}),router.get("/search",function(t,r){var n,s,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.query.search,console.log("Search Query:",n),n){e.next=4;break}return e.abrupt("return",r.status(400).json({message:"No search term provided"}));case 4:return e.prev=4,s=new RegExp(n,"i"),e.next=8,regeneratorRuntime.awrap(BlogPost.find({$or:[{title:s},{content:s}]}));case 8:if(0===(a=e.sent).length)return e.abrupt("return",r.status(404).json({message:"No posts found matching your query"}));e.next=11;break;case 11:r.json(a),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(4),console.error("Error during search:",e.t0),r.status(500).json({message:"Internal server error",error:e.t0.message});case 18:case"end":return e.stop()}},null,null,[[4,14]])}),module.exports=router;
//# sourceMappingURL=blogRoutes.min.js.map
